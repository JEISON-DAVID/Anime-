<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Detalles del Anime - ANIME GALAXI</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <nav class="sidebar">
        <!-- Mismo sidebar que el index.html -->
    </nav>

    <main class="main-content">
        <div id="animeDetails" class="anime-details active"></div>
    </main>

    <script>
        const API_BASE = 'https://animeflv.ahmedrangel.com/api';
        
        async function fetchAPI(endpoint) {
            try {
                const response = await fetch(`${API_BASE}${endpoint}`);
                const data = await response.json();
                return data;
            } catch (error) {
                console.error('Error fetching data:', error);
                return null;
            }
        }

        async function loadAnimeDetails() {
            const urlParams = new URLSearchParams(window.location.search);
            const slug = urlParams.get('slug');
            
            if (!slug) {
                window.location.href = 'index.html';
                return;
            }

            const detailsSection = document.getElementById('animeDetails');
            const data = await fetchAPI(`/anime/${slug}`);
            
            if (data?.success) {
                detailsSection.innerHTML = `
                    <div class="details-header">
                        <div class="details-cover">
                            <img src="${data.data.cover}" alt="${data.data.title}">
                        </div>
                        <div class="details-info">
                            <h2>${data.data.title}</h2>
                            <div class="details-meta">
                                <div class="meta-item">
                                    <span class="meta-label">Estado:</span>
                                    <span>${data.data.status}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">Tipo:</span>
                                    <span>${data.data.type}</span>
                                </div>
                                <div class="meta-item">
                                    <span class="meta-label">Rating:</span>
                                    <span>${data.data.rating}</span>
                                </div>
                            </div>
                            <div class="synopsis">
                                <p>${data.data.synopsis}</p>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">GÃ©neros:</span>
                                <span>${data.data.genres.join(', ')}</span>
                            </div>
                        </div>
                    </div>
                    <div class="episodes-section">
                        <h3>Episodios</h3>
                        <div class="episodes-grid">
                            ${data.data.episodes.map(episode => `
                                <button class="episode-button" onclick="openEpisode('${episode.slug}')">
                                    Episodio ${episode.number}
                                </button>
                            `).join('')}
                        </div>
                    </div>
                `;
            }
        }

        function openEpisode(episodeSlug) {
            window.location.href = `player.html?episode=${episodeSlug}`;
        }

        document.addEventListener('DOMContentLoaded', loadAnimeDetails);
    </script>
</body>
</html>
